---
sidebar_position: 12
---
# VPC
## Virtual Private Cloud
С помощью **VPC** можно запускать ресурсы **AWS** в определенной вами логически изолированной виртуальной сети. Эта виртуальная сеть очень похожа на традиционную сеть, которую вы можете использовать в собственном центре обработки данных, с преимуществами использования масштабируемой инфраструктуры **AWS**.
:::info
**VPC** может быть несколько в AWS регионе (максимум 5 на регион, но это софтовое ограничение, так что можно увеличить).
:::

На следующей диаграмме показан пример **VPC**. **VPC** имеет одну подсеть в каждой из `Availability Zones` в `Region`, **EC2** инстансы в каждой подсети и `Internet Gateway`, обеспечивающий связь между ресурсами вашего **VPC** и Интернетом.

![AWS VPC Example](./img/vpc-example.png)

VPC Components Diagram:
![VPC Components Diagram](./img/vpc-components-diagram.png)

## CIDR
**Classless Inter-Domain Routing** (*бесклассовая междоменная маршрутизация*) — это метод выделения **IP**-адресов, который повышает эффективность маршрутизации данных в Интернете. Каждая машина, сервер и устройство конечного пользователя, подключающееся к Интернету, имеют связанный с ним уникальный номер, называемый **IP**-адресом. Устройства находят друг друга и взаимодействуют друг с другом, используя эти **IP**-адреса. Организации используют **CIDR** для гибкого и эффективного распределения **IP**-адресов в своих сетях. Вместо классификации **IP**-адреса на основе классов маршрутизаторы получают адрес сети и хоста, указанный суффиксом **CIDR**.

**CIDR** используется в правилах `Security Groups` (как и AWS networking в целом) и помогает определить ренж **IP** адресов. Например, *ww.xx.yy.zz/32* => `1` **IP**, а *0.0.0.0/0* => все **IPs**. Если мы укажем *192.168.0.0/26* - это будет ренж от *192.168.0.0* до *192.168.0.63* (`64` **IP** адреса).

**CIDR** состоит из двух компонентов:
- **Base IP**: базовый IP, типо 10.0.0.0, 192.168.0.0 и тд.
- **Subnet Mask**: определяет сколько можно именить битов в IP (/0, /24, /34).

![CIDR notation](./img/CIDR-notation.webp)

**Subnet Mask** в основном позволяет части базового **IP**-адреса получать дополнительные следующие значения из базового **IP**-адреса.

![CIDR Subnet Mask](./img/CIDR_SubnetMask.png)

![CIDR Octets](./img/CIDR_Octets.png)

:::info
Лимиты по **CIDR**:
- Min size is /28 (16 IP addresses)
- Max size is /16 (65536 IP addresses)
:::
:::caution
Наш **VPC CIDR** не должен пересекаться с другими нашими сетями (корпоративными).
:::

## Public vs Private IP
**IANA** (*Internet Assigned Numbers Authority*) установили определенные блоки адресов **IPv4** для использования частных (**LAN**) и общедоступных (**Интернет**) адресов:
- **Private IP**: 
  - *10.0.0.0* - *10.255.255.255* (**10.0.0.0/8**) 
  - *172.16.0.0* - *172.31.255.255* (**172.16.0.0/12**) AWS default VPC in that range
  - *192.168.0.0* - *192.168.255.255* (**192.168.0.0/16**) home networks
> Так как **VPC** - это приватная сеть, то только `Private IPv4` ренжи могут быть использованы.

Все остальные ренжи являются **публичными**.

## Default VPC Walkthrough
- Все новые AWS аккаунты имеют дефолтную **VPC**. 
- Новые **EC2** инстансы запускаются в дефолтной **VPC** если никакая подсеть не была указана. 
- Дефолтная **VPC** имеет выход в Интернет и все **EC2** инстансы внутри имеют публичные **IPv4**.
- Нам доступны публичные и приватные **IPv4** **DNS** имена.

## Subnets
Подсеть - это такой саб-ренж наших **IPv4** адресов внутри нашего **VPC**.

AWS резервирует 5 **IP** адресов (первые 4 и последний 1) в каждой подсети. Например, если **CIDR** block *10.0.0.0/24*, тогда зарезервируемые **IP** адреса будут следующие:
- *10.0.0.0* - сетевой адрес
- *10.0.0.1* - reserved by AWS, VPC роутер
- *10.0.0.2* - reserved by AWS, для маппинга Amazon-provided DNS
- *10.0.0.3* - reserved by AWS, для дальнейшего использования
- *10.0.0.255* - Network Broadcast Address, хоть AWS в VPC не поддерживает броадкаст, но этот адрес является зарезервированным

## Internet Gateway (IGW)
**IGW** помогает AWS ресурсам, таким как **EC2** инстансам, выходить в Интернет, находясь в **VPC**. Создается отдельно от **VPC**. К одному **IGW** может быть прикреплена одна **VPC** и наоборот. 

По своей сути **IGW** не позволяет выход в Интернет, для этого надо редактировать `Route Tables` так, чтобы тот же **EC2** инстанс мог законнектиться с роутером и потом законнектиться с **IGW**, а оттуда уже законнектиться с Интернетом.

## Bastion Hosts